{% load staticfiles socialaccount compress %}
<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Article" ng-app="framebuzz">
  <head>
    {% if close_window %}
      <script type="text/javascript">
        window.opener.location.reload();
        window.close();
      </script>
    {% endif %}
    <title>FrameBuzz | {{ video.title }}</title>
    <meta name="description" content="{{ video.description }}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="FrameBuzz: {{ video.title }}">
    <meta property="og:type" content="Video">
    <meta property="og:url" content="http://{{ current_site }}{{ video.get_absolute_url }}">
    <meta property="og:image" content="{{ video.default_thumbnail.url }}">
    <meta property="og:description" content="I'm watching {{ video.title }}. Come talk about it with me on FrameBuzz!">
    <meta property="og:site_name" content="FrameBuzz">
    <meta itemprop="name" content="FrameBuzz: {{ video.title }}">
    <meta itemprop="description" content="I'm watching {{ video.title }}. Come talk about it with me on FrameBuzz!">
    <meta itemprop="image" content="{{ video.default_thumbnail.url }}">
    {% compress css %}
      <link href="{% static 'framebuzz/player/app/css/bootstrap.min.css' %}" media="screen, projection" rel="stylesheet" type="text/css">
      <link href="{% static 'framebuzz/player/app/css/bootstrap-responsive.min.css' %}" media="screen, projection" rel="stylesheet" type="text/css">
      <link href="{% static 'framebuzz/player/app/css/mediaelementplayer.min.css' %}" media="screen, projection" rel="stylesheet" type="text/css">
      <link href="{% static 'framebuzz/player/app/css/mejs-skins.css' %}" media="screen, projection" rel="stylesheet" type="text/css">
      <link href="{% static 'framebuzz/player/app/sass/stylesheets/screen.css' %}" media="screen, projection" rel="stylesheet" type="text/css">
      <!--[if IE 7]>
        <link href="{% static 'framebuzz/player/app/css/font-awesome-ie7.min.css' %}" media="screen, projection" rel="stylesheet" type="text/css">
      <![endif]-->
      <!--[if IE]>
          <link href="{% static 'framebuzz/player/app/sass/stylesheets/ie.css' %}" media="screen, projection" rel="stylesheet" type="text/css">
      <![endif]-->
    {% endcompress %}
    <script type="text/javascript" src="//use.typekit.net/jbo8iic.js"></script>
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
    {% compress js %}
      <script type="text/javascript">
        // Disable ESC as it breaks SockJS connection.
        // See https://github.com/sockjs/sockjs-client/issues/18.
        window.addEventListener('keydown', function(e) { (e.keyCode == 27 && e.preventDefault()) });

        // Set up our global SOCK variable.
        var SOCK = {
          host: location.hostname,
          port: {{ socket_port }},
          channel: '{{ socket_channel }}',
          video_channel: '/framebuzz/video/' + '{{ video.video_id }}'
        };
      </script>
    {% endcompress %}
  </head>
  <body ng-controller="VideoPlayerCtrl" class="ng-cloak">
    {% providers_media_js %}
    <div id="player-container" class="container">
      <div class="row-fluid">
        <div id="player-layer" class="layer">
          <div class="row-fluid">
            <video media-element class="span12" id="video-element" preload="none" type="video/youtube" src="{{ video.swf_url }}">
            </video>
          </div>
          <div class="row-fluid">
            <table id="heatmap" class="span12" cellpadding="0" cellspacing="0">
              <tr>
                {% verbatim %}
                  <td class="{{ block.className }}" ng-repeat="block in videoInstance.heatmap"></td>
                {% endverbatim %}
              </tr>
            </table>
          </div>
          <div class="row-fluid">
            <form method="post" action="" id="post-comment-form" class="span12">
              {% csrf_token %}
              <p style="display:none;"><input type="text" id="id_honeypot" name="honeypot"></p>
              {% verbatim %}
                <div class="input-prepend input-append">
                  <span class="add-on"><em class="current">{{ currentTimeHMS }}</em><em> / </em>{{ videoInstance.video.time_hms }}</span>

                  <input type="text" id="id_comment" name="comment" maxlength="180" placeholder="Post a comment..." ng-show="videoInstance.is_authenticated">
                  <input type="text" id="id_comment" name="comment" placeholder="Please login to post a comment!" ng-hide="videoInstance.is_authenticated" disabled>
                  <button type="submit" id="submit-comment" class="btn">
                {% endverbatim %}
                    <img src="{% static 'framebuzz/player/app/img/icon-post-comment.png' %}" alt="Post Comment" class="fb-icon-post-comment" />
                {% verbatim %}
                  </button>
                </div>
                <input type="hidden" id="id_time" name="time" value="0.00">
                <input type="hidden" id="id_parent" name="parent">
                <input type="hidden" id="id_object_pk" name="object_pk" value="{{ videoInstance.video.id }}">
                <input type="hidden" id="id_content_type" value="core.video" name="content_type">
              {% endverbatim %}
            </form>
          </div>
        </div>
        <div id="buzz-layer" class="layer offset2 span4">
          <div class="row-fluid">
            <div id="blended-view" class="panel">
              <ul class="comment-stream">
                {% verbatim %}
                  <li ng-repeat="thread in videoInstance.threads" ng-hide="thread.time > currentTime">                  
                    <div class="thread">
                      <div class="header">
                        <strong class="username">{{ thread.user.username }}</strong>
                        <strong class="time">{{ thread.time_hms }}</strong>
                      </div>
                      <p>{{ thread.comment }}</p>
                    </div>
                    <img class="img-circle" src="{{ thread.user.avatar_url }}" alt="" />
                  </li>
                {% endverbatim %}
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="//cdn.sockjs.org/sockjs-0.3.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.1.5/angular.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    {% compress js %}
      <script src="{% static 'framebuzz/js/vendor/plugins.js' %}"></script>
      <script src="{% static 'framebuzz/player/app/lib/mediaelement-and-player.js' %}"></script>
      <script src="{% static 'framebuzz/player/app/lib/mejs-framebuzz-plugins.js' %}"></script>
      <script src="{% static 'framebuzz/player/app/js/app.js' %}"></script>
      <script src="{% static 'framebuzz/player/app/js/services.js' %}"></script>
      <script src="{% static 'framebuzz/player/app/js/controllers.js' %}"></script>
      <script src="{% static 'framebuzz/player/app/js/filters.js' %}"></script>
      <script src="{% static 'framebuzz/player/app/js/directives.js' %}"></script>
    {% endcompress %}
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-40966336-1', 'framebuzz.com');
      ga('send', 'pageview');
    </script>
  </body>
</html>