{% load avatar_tags profile_tags comments %}

{% regroup commenters by actor.username as commenter_list %}
<div class="col-xs-12{% if not profile_user %} standalone{% endif %}">
    {% comment %}
    <div id="share-container" class="clearfix">
        <div id="stats-container">
            {% get_comment_count for video as comment_count %}
            <div class="stat comments">
                <p>
                    <i class="icon-4x icon-comment"></i>
                    <span>{{ comment_count }}</span>
                </p>
                <h4>Comment{{ comment_count|pluralize }}</h4>
            </div>
            {% for commenter in commenter_list %}
                <div class="stat commenters">
                    <p>
                        <i class="icon-4x icon-group"></i>
                        <span>{{ commenter.list|length }}</span>
                    </p>
                    <h4>Commenter{{ commenter.list|length|pluralize }}</h4>
                </div> 
            {% empty %}
                <div class="stat commenters">
                    <p>
                        <i class="icon-4x icon-group"></i>
                        <span>0</span>
                    </p>
                    <h4>Commenter{{ commenter.list|length|pluralize }}</h4>
                </div>
            {% endfor %}
            <div class="stat shares">
                <p>
                    <i class="icon-4x icon-fbshare"></i>
                    <span>{{ shares }}</span>
                </p>
                <h4>Share{{ shares|pluralize }}</h4>
            </div>
        </div>
        {% endcomment %}
        <div class="row video">
            <div class="col-xs-12">
                <h1>{{ video.title|title }}</h1>
                <iframe src="{% url 'video-embed' video.video_id %}" scrolling="no" frameBorder="0" height="398" width="640" class="center-block"></iframe>
            </div>
        </div>
        <div class="row container details clearfix">
            <div class="col-xs-3 {% if not request.user.is_authenticated and not found_by %} hidden{% endif %}">
                {% if found_by %}
                    <h2>Found By</h2>
                    <a title="{{ found_by|display_name }}" href="{% url 'profiles-home' found_by.username %}">
                        <img src="{% avatar_url found_by 110 %}" alt="" class="img-responsive" />
                    </a>
                {% else %}
                    {% if request.user.is_authenticated %}
                        <h2>Add to Library</h2>
                        <a class="add-to-library video-toggle-button" href="{% url 'profiles-toggle-library' request.user.username video.video_id %}">
                            <i class="icon-plus-sign-alt"></i>
                        </a>
                    {% endif %}
                {% endif %}
            </div>
            <div class="col-xs-5 description">
                <h2>Description</h2>
                <div class="scroller">
                    <p>{{ video.formatted_description|linebreaks|urlize }}</p>
                </div>
            </div>
            <div class="col-xs-4">
                <h2>Commenters</h2>
                <ul class="row">
                    {% for commenter in commenter_list|slice:":8" %}
                        {% for item in commenter.list %}
                            <li class="pull-left">
                                <a title="{{ item|display_name }}" href="{% url 'profiles-home' item.username %}">
                                    <img src="{% avatar_url item 60 %}" alt="" width="48" height="48" class="img-responsive" />
                                </a>
                            </li>
                        {% empty %}
                            <li class="empty shown">No commenters yet!</li>
                        {% endfor %}
                    {% endfor %}
                </ul>
            </div>
        </div>
</div>