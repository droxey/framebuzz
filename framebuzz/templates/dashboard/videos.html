{% extends "dashboard/base.html" %}
{% load staticfiles addendum_tags account socialaccount avatar_tags compress profile_tags dashboard_tags %}

{% block page_header %}
    <link rel="stylesheet" href="{% static 'framebuzz/dashboard/theme/assets/css/to-do.css' %}">
{% endblock %}

{% block page_content %}

  <section class="wrapper site-min-height home-wrapper">
      <div class="row">
          <div class="col-lg-12 main-chart">   
            <h3><i class="fa fa-angle-right"></i> Videos</h3>
                <hr>
                {% for group in videos|group_by:3 %}
                <div class="row mt">
                    {% for video in group %}
                        <div class="col-lg-4 col-md-4 col-sm-4 mb video-panel" data-remote="{% url 'dashboard-video-details' video.slug %}" data-title="{{ video.title|title }}" data-slug="{{ video.slug }}">
                            <div class="content-panel pn">
                                <div class="panel-bkg">
                                    <img class="cover lazy-load img-responsive" src="{{ video.poster_image }}">
                                </div>
                                <div class="pr2-social" id="{{ video.slug }}">
                                    <h5><strong class="title">{{ video.title|title|truncatechars:"55" }} <i class="fa fa-chevron-right pull-right"></i></strong></h5>
                                </div>
                            </div><!-- --/panel ---->
                        </div>
                    {% endfor %}
                </div>
                <div class="row mt inline-modal">
                    <div class="col-xs-12 inline-modal-content">
                        <div class="row">
                            <div class="col-xs-12">
                                <h3 class="video-title pull-left"></h3>
                                <a class="inline-close pull-right" href="#" rel="close">
                                    <i class="fa fa-times"></i>
                                </a>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12 inner-content">
                                <div class="ajax-indicator-row text-center">
                                    <i class="fa fa-4x fa-cog fa-spin ajax-indicator"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div><!-- /col-lg-12 END SECTION MIDDLE -->
    </div>
</section>
{% endblock %}

{% block page_javascript %} 
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>   

  {% compress js %}
  <script src="{% static 'framebuzz/dashboard/theme/assets/js/tasks.js' %}" type="text/javascript"></script>
  <script type="text/javascript">
      $(function() {
        $('.lazy-load').lazyLoadXT();

        $(document).on('click', 'div.video-panel', function(e) {
            var inline = $(this).parent().next('div.inline-modal');
            var url = $(this).attr('data-remote');
            var title = $(this).attr('data-title');
            var slug = $(this).attr('data-slug');

            $('.inline-modal.active').hide().removeClass('active');
            $('div.video-panel .title').removeClass('selected');
            $(this).find('.title').addClass('selected');

            inline.find('.video-title').html(title);

            inline.slideDown('fast', function() {
                $(document).scrollTo('#' + slug, 300, {
                    onAfter: function() {
                        $.get(url, function(html) {
                                
                            inline.addClass('active');
                            inline.find('.inner-content').html(html);
                            inline.find('.iframe-wrapper > iframe').lazyLoadXT();

                            TaskList.initTaskWidget();
                        });
                    }
                });
            });
        });

        $(document).on('click', 'a.inline-close', function(e) {
            e.preventDefault();

            $(this).parent().parent().parent().parent().hide('fast');

            return false;
        });
      });
  </script>
  {% endcompress %}
{% endblock %}