{% extends "base.html" %}
{% load staticfiles compress avatar_tags activity_tags profile_tags %}

{% block page_classes %}content profiles{% endblock %}

{% block title %}{{ profile_user|display_name }}'s Profile{% endblock %}

{% block marketing_meta %}
    {% if is_share %}
        <meta property="og:title" content="FrameBuzz: {{ video.title }}" />
        <meta property="og:type" content="Video" />
        <meta property="og:url" content="http://framebuzz.com{% url 'video-share' video.video_id %}" />
        <meta property="og:image" content="{{ video.poster_image }}" />
        <meta property="og:description" content="I'm watching {{ video.title }}. Come talk about it with me on FrameBuzz!" />
        <meta property="og:site_name" content="FrameBuzz" />
        <meta itemprop="name" content="FrameBuzz: {{ video.title }}" />
        <meta itemprop="description" content="I'm watching {{ video.title }}. Come talk about it with me on FrameBuzz!" />
        <meta itemprop="image" content="{{ video.poster_image }}" />
    {% else %}
        <meta property="og:title" content="FrameBuzz: {{ profile_user|display_name }}'s Profile" />
        <meta property="og:url" content="http://framebuzz.com{{ profile_user.get_absolute_url }}" />
        <meta property="og:image" content="http://framebuzz.com{% avatar_url profile_user 265 %}" />
        <meta property="og:description" content="{{ profile_user.get_profile.tagline }}" />
        <meta property="og:site_name" content="FrameBuzz" />
        <meta itemprop="name" content="FrameBuzz: {{ profile_user|display_name }}'s Profile" />
        <meta itemprop="description" content="{{ profile_user.get_profile.tagline }}" />
        <meta itemprop="image" content="http://framebuzz.com{% avatar_url profile_user 265 %}" />
    {% endif %}
{% endblock %}

{% block page_css %}
    {% compress css %}
        <link href="{% static 'framebuzz/profiles/vendor/timeline/css/stylesheet.css' %}" media="screen, projection" rel="stylesheet" type="text/css">
        <link href="{% static 'framebuzz/profiles/stylesheets/screen.css' %}" media="screen, projection" rel="stylesheet" type="text/css">
    {% endcompress %}
    {% block extra_css %}{% endblock %}
{% endblock %}

{% block main_header %}
  <div id="logo" class="row">
    <div class="col-xs-2 row-logo">
      <a href="{% url 'home' %}">
        <img src="{% static 'framebuzz/marketing/img/logo.png' %}" alt="FrameBuzz" height="25" width="116">
      </a>
    </div>
    <div class="col-xs-8 row-search">
        <form id="search-form" data-users-url="{% url 'search-users' %}" data-conversations-url="{% url 'search-conversations' %}" data-videos-url="{% url 'search-videos' %}" method="GET" action="{% url 'fbz-search' %}" class="navbar-search">
            <i class="fa fa-search"></i>
            <input type="text" name="query" value="{{ request.GET.query }}" placeholder="Search people, conversations, and videos..." class="search-query span2">
            <button type="submit"></button>
        </form>
    </div>
    <div class="col-xs-2 row-user">
        <ul class="nav pull-right">
            <li class="dropdown">
                <a class="dropdown-toggle clearfix" href="#" data-toggle="dropdown">
                    <img src="{% avatar_url profile_user 82 %}" alt="{{ profile_user|display_name }}" height="41" width="41" class="img-circle pull-left">
                    <i class="fa fa-cog pull-left"></i>
                    <i class="fa fa-caret-down pull-left"></i>
                </a>
                <div class="dropdown-menu"></div>
            </li>
        </ul>
    </div>
  </div>
{% endblock %}

{% block content_center %}
    {% comment %}
    <div class="content">
        <div class="wrapper">
            <div class="background">
                <div id="profile-container" class="clearfix">                        
                    <nav id="profile-sections" class="span4{% if is_my_profile %} edit{% endif %}">
                        <div class="user-info clearfix">
                            {% if is_my_profile %}
                                <a data-modal="customize-modal" data-role="button" class="customize md-trigger" href="{% url 'avatar_add' %}"><i class="icon-cogs"></i></a>
                            {% endif %}
                            <div class="user-details">
                                {% spaceless %}
                                <h1 class="clearfix">
                                    <span class="username-field">
                                        {% if is_my_profile %}
                                            <a href="#" class="display-name clearfix">
                                                <span class="editable" data-placement="right" data-name="display_name" data-type="text" data-pk="{{ request.user.get_profile.id }}" data-url="{% url 'profiles-edit' request.user.username %}" data-title="Edit Display Name">
                                                    {{ profile_user|display_name }}
                                                </span>
                                            </a>
                                        {% else %}
                                            {{ profile_user|display_name }}
                                        {% endif %}
                                    </span>
                                    <span class="location-field clearfix">
                                        {% if is_my_profile %}
                                            <i class="icon-map-marker"></i>
                                            <a href="#" class="location clearfix">
                                                <span class="editable" data-placement="right" data-name="location" data-type="text" data-pk="{{ request.user.get_profile.id }}" data-url="{% url 'profiles-edit' request.user.username %}" data-title="Edit Location">
                                                    {% if profile_user.get_profile.location %}
                                                        {{ profile_user.get_profile.location }}
                                                    {% else %}
                                                        Add Location
                                                    {% endif %}
                                                </span>
                                            </a>
                                        {% else %}
                                            {% if profile_user.get_profile.location %}
                                                <i class="icon-map-marker"></i>
                                                {{ profile_user.get_profile.location }}
                                            {% endif %}
                                        {% endif %}
                                    </span>
                                </h1>
                                {% endspaceless %}
                                {% if profile_user.get_profile %}
                                    {% spaceless %}                                
                                        {% if is_my_profile %}
                                            <h2><a href="#" data-name="tagline" class="editable" data-type="textarea" data-pk="{{ request.user.get_profile.id }}" data-url="{% url 'profiles-edit' request.user.username %}" data-placement="right" data-title="Edit Tagline">{% if profile_user.get_profile.tagline %}{{ profile_user.get_profile.tagline }}{% else %}Click to add your tagline{% endif %}</a></h2>
                                        {% else %}
                                            {% if profile_user.get_profile.tagline %}<h2>{{ profile_user.get_profile.tagline|urlize }}</h2>{% endif %}
                                        {% endif %}
                                    {% endspaceless %}
                                    <ul class="nav nav-tabs clearfix">
                                        <li class="videos">
                                            <a class="filter" data-filter=".added_video_to_library" href="#" data-pages="{{ page_counts.videos }}">
                                                <em>{{ profile_library|length }}</em>
                                                <br>
                                                Post{{ profile_library|length|pluralize }}
                                            </a>
                                        </li>
                                        <li class="conversations">
                                            <a class="filter" data-filter=".conversations" href="#" data-pages="{{ page_counts.conversations }}">
                                                <em>{{ profile_conversations|length }}</em>
                                                <br>
                                                Comment{{ profile_conversations|length|pluralize }}
                                            </a>
                                        </li>
                                        <li class="favorites">
                                            <a class="filter" data-filter=".added_to_favorites" href="#" data-pages="{{ page_counts.favorites }}">
                                                <em>{{ profile_favorites|length }}</em>
                                                <br>
                                                Favorite{{ profile_favorites|length|pluralize }}
                                            </a>
                                        </li>
                                        <li class="followers">
                                            <a class="filter" data-filter=".followers" href="#" data-pages="{{ page_counts.followers }}">
                                                <em>{{ profile_followers|length }}</em>
                                                <br>
                                                Follower{{ profile_followers|length|pluralize }}
                                            </a>
                                        </li>
                                        <li class="following">
                                            <a class="filter" data-filter=".following" href="#" data-pages="{{ page_counts.following }}">
                                                <em>{{ profile_following|length }}</em>
                                                <br>
                                                Following
                                            </a>
                                        </li>
                                    </ul>   
                                    {% if is_my_profile %}                                            
                                        <p class="bio"><a href="#" data-name="bio" class="editable" data-type="textarea" data-pk="{{ profile_user.get_profile.id }}" data-url="{% url 'profiles-edit' profile_user.username %}" data-title="Edit Bio" data-placement="bottom">{% if profile_user.get_profile.bio and profile_user.get_profile.bio|length > 0 %}{{ profile_user.get_profile.bio }}{% else %}Click to add a description of who you are and the things you love.{% endif %}</a></p>
                                    {% else %}
                                        <p class="bio">
                                            {% if profile_user.get_profile.bio %}
                                                {{ profile_user.get_profile.bio|urlize }}
                                            {% endif %}
                                        </p>
                                    {% endif %}
                                {% endif %}
                            </div>
                            {% if is_my_profile %}
                                <div class="recommendations clearfix">
                                    <h2>Recommendations</h2>
                                    <div class="ajax">
                                        <div class="spin">
                                            <i class="icon-spinner icon-spin icon-2x"></i>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </nav>
                    <div class="tab-content span7">
                        {% if is_my_profile %}
                            <div id="add-video">
                                <span class="corner"></span>
                                {% include "profiles/snippets/add_video.html" %}
                            </div>
                        {% endif %}
                        <nav class="clearfix">
                            <ul class="nav nav-pills clearfix">
                                <li class="filter"><i class="icon-filter"></i></li>
                                <li class="start{% if not is_share %} active{% endif %}">
                                    <a class="filter latest" data-filter="*" href="#">Latest</a>
                                </li>
                                <li{% if is_share %} class="active"{% endif %}>
                                    <a class="filter" data-filter=".added_video_to_library" href="#" data-pages="{{ page_counts.videos }}">Posts</a>
                                </li>
                                <li>
                                    <a class="filter" data-filter=".conversations" href="#" data-pages="{{ page_counts.conversations }}">Comments</a>
                                </li>
                                <li>
                                    <a class="filter" data-filter=".added_to_favorites" href="#" data-pages="{{ page_counts.favorites }}">Favorites</a>
                                </li>
                                <li>
                                    <a class="filter" data-filter=".followers" href="#" data-pages="{{ page_counts.followers }}">Followers</a>
                                </li>
                                <li>
                                    <a class="filter" data-filter=".following" href="#" data-pages="{{ page_counts.following }}">Following</a>
                                </li>                                                                        
                            </ul>
                            {% if not is_my_profile %}
                                {% if request.user.is_authenticated %}
                                    <a class="toggle-follow unfollow-button tooltip" title="Following" data-placement="bottom" href="{% url 'actstream_unfollow' content_type_id=user_content_type.pk object_id=profile_user.pk %}" {% if not request.user|is_following:profile_user %} style="display:none"{% endif %}>
                                      <span class="icon-stack">
                                        <i class="icon-sign-blank icon-stack-base"></i>
                                        <i class="icon-user icon-light"></i>
                                        <i class="icon-minus icon-light"></i>
                                      </span>            
                                    </a>
                                    <a class="toggle-follow follow-button tooltip" title="Follow" data-placement="bottom" href="{% url 'actstream_follow' content_type_id=user_content_type.pk object_id=profile_user.pk %}" {% if request.user|is_following:profile_user %} style="display:none"{% endif %}>
                                      <span class="icon-stack">
                                        <i class="icon-sign-blank icon-stack-base"></i>
                                        <i class="icon-user icon-light"></i>
                                        <i class="icon-plus icon-light"></i>
                                      </span>
                                    </a>
                                {% endif %}
                            {% endif %}
                        </nav>
                        {% if is_share %}
                            {% include "player/snippets/share.html" %}
                        {% endif %}
                        <div id="feed">
                            <div class="spin">
                                <i class="icon-spinner icon-spin icon-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endcomment %}

    <div class="col-md-12">
        <div class="row">
            <div id="sidebar" class="col-md-3">
                <div id="user-avatar" class="row">
                    <a href="{% url 'profiles-home' profile_user.username %}" class="avatar filter" data-filter="*">
                        <img src="{% static 'framebuzz/profiles/img/blank.png' %}" data-original="{% avatar_url profile_user 109 %}" alt="" class="img-responsive lazy">
                    </a>
                </div>
                <div id="user-display-name" class="row">
                    <div class="col-md-10">
                        <h1>{{ profile_user|display_name }}</h1>
                    </div>
                    <div class="col-md-2">
                        {% if not is_my_profile %}
                            {% if request.user.is_authenticated %}
                                <a class="toggle-follow unfollow-button pull-right img-circle" title="Following" data-placement="bottom" href="{% url 'actstream_unfollow' content_type_id=user_content_type.pk object_id=profile_user.pk %}" {% if not request.user|is_following:profile_user %} style="display:none"{% endif %}>
                                  <span class="fa-stack">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-user fa-stack-1x fa-inverse"></i>
                                    <i class="fa fa-minus fa-stack-1x fa-inverse pull-right"></i>
                                  </span>            
                                </a>
                                <a class="toggle-follow follow-button pull-right img-circle" title="Follow" data-placement="bottom" href="{% url 'actstream_follow' content_type_id=user_content_type.pk object_id=profile_user.pk %}" {% if request.user|is_following:profile_user %} style="display:none"{% endif %}>
                                  <span class="fa-stack">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-user fa-stack-1x fa-inverse"></i>
                                    <i class="fa fa-plus fa-stack-1x fa-inverse pull-right"></i>
                                  </span>
                                </a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                <div id="user-details" class="row">
                    <h2></h2>
                    <h3></h3>
                    <em></em>
                </div>
                <div id="user-stats" class="row container">
                    <div class="col-md-12">
                        <ul class="nav nav-tabs">
                            <li class="videos">
                                <a class="filter" data-filter=".added_video_to_library" href="#" data-pages="{{ page_counts.videos }}">
                                    <i class="fa fa-video-camera"></i>
                                    <strong>{{ profile_library|length }}</strong>
                                </a>
                            </li>
                            <li class="conversations">
                                <a class="filter" data-filter=".conversations" href="#" data-pages="{{ page_counts.conversations }}">
                                    <i class="fa fa-comment"></i>
                                    <strong>{{ profile_conversations|length }}</strong>
                                </a>
                            </li>
                            <li class="favorites">
                                <a class="filter" data-filter=".added_to_favorites" href="#" data-pages="{{ page_counts.favorites }}">
                                    <i class="fa fa-heart"></i>
                                    <strong>{{ profile_favorites|length }}</strong>
                                </a>
                            </li>
                            <li class="followers">
                                <a class="filter" data-filter=".followers" href="#" data-pages="{{ page_counts.followers }}">
                                    <i class="fa fa-group"></i>
                                    <strong>{{ profile_followers|length }}</strong>
                                </a>
                            </li>
                            <li class="following">
                                <a class="filter" data-filter=".following" href="#" data-pages="{{ page_counts.following }}">
                                    <i class="fa fa-user"></i>
                                    <strong>{{ profile_following|length }}</strong>
                                </a>
                            </li>
                        </ul>  
                    </div>
                </div>
                {% if is_my_profile %}
                    <div id="recommendations" class="row">
                        <div class="col-md-12">
                            <h2>Recommendations</h2>
                            <div class="ajax">
                                <div class="spin">
                                    <i class="icon-spinner icon-spin icon-2x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            </div>
            <div id="profile-content" class="col-md-9">
                <div id="add-video" class="row">
                    {% include "profiles/snippets/add_video.html" %}
                </div>
                <div id="timeline" class="row">
                    <div class="col-md-12">
                        <nav class="row">
                            <ul class="nav nav-pills clearfix">
                                <li class="filter"><i class="icon-filter"></i></li>
                                <li class="start{% if not is_share %} active{% endif %}">
                                    <a class="filter latest" data-filter="*" href="#">Latest</a>
                                </li>
                                <li{% if is_share %} class="active"{% endif %}>
                                    <a class="filter" data-filter=".added_video_to_library" href="#" data-pages="{{ page_counts.videos }}">Posts</a>
                                </li>
                                <li>
                                    <a class="filter" data-filter=".conversations" href="#" data-pages="{{ page_counts.conversations }}">Comments</a>
                                </li>
                                <li>
                                    <a class="filter" data-filter=".added_to_favorites" href="#" data-pages="{{ page_counts.favorites }}">Favorites</a>
                                </li>
                                <li>
                                    <a class="filter" data-filter=".followers" href="#" data-pages="{{ page_counts.followers }}">Followers</a>
                                </li>
                                <li>
                                    <a class="filter" data-filter=".following" href="#" data-pages="{{ page_counts.following }}">Following</a>
                                </li>
                            </ul>
                        </nav>
                        <div id="feed" class="row">
                            <div class="spin">
                                <i class="icon-spinner icon-spin icon-3x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block modals %}
    <div class="md-modal md-effect-1" id="customize-modal">
        <div class="md-content">
            <h3>Customize Profile <button class="md-close"><i class="icon-remove"></i></button></h3>
            <nav>
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a href="#add" data-url="{% url 'avatar_add' %}">Upload Avatar</a>
                    </li>
                    {% comment %}
                    <li>
                        <a href="#change" data-url="{% url 'avatar_change' %}">Change Avatar</a>
                    </li>
                    <li>
                        <a href="#background">Change Background</a>
                    </li>
                    {% endcomment %}
                </ul>
            </nav>
            <div class="tab-content">
                <div id="add" class="tab-pane active"></div>
                <div id="change" class="tab-pane"></div>
                <div id="background" class="tab-pane"></div>
            </div>
        </div>
    </div>
    <div class="md-overlay"></div>
{% endblock %}

{% block page_javascript %}
    {% compress js %}
        {% if is_my_profile %}
            <script src="{% static 'framebuzz/profiles/vendor/jquery/ui/js/jquery-ui-1.10.3.custom.min.js' %}"></script>
            <script src="{% static 'framebuzz/profiles/vendor/jquery/fileupload/canvas-to-blob.min.js' %}"></script>
            <script src="{% static 'framebuzz/profiles/vendor/jquery/fileupload/load-image.min.js' %}"></script>
            <script src="{% static 'framebuzz/profiles/vendor/jquery/fileupload/jquery.iframe-transport.js' %}"></script>
            <script src="{% static 'framebuzz/profiles/vendor/jquery/fileupload/jquery.fileupload.js' %}"></script>
            <script src="{% static 'framebuzz/profiles/vendor/jquery/fileupload/jquery.fileupload-process.js' %}"></script>
            <script src="{% static 'framebuzz/profiles/vendor/jquery/fileupload/jquery.fileupload-image.js' %}"></script>
            <script src="{% static 'framebuzz/profiles/vendor/jquery/fileupload/jquery.fileupload-validate.js' %}"></script>
        {% endif %}
        <script src="{% static 'framebuzz/profiles/vendor/jquery/jquery.lazyload.min.js' %}"></script>
        <script src="{% static 'framebuzz/profiles/vendor/timeline/timeline.js' %}"></script>
        <script src="{% static 'framebuzz/profiles/js/framebuzz.profiles.js' %}"></script>
        <script type="text/javascript">
            $(function(){
                var isMyProfile = '{{ is_my_profile|lower }}' == 'true';
                var isShare = '{{ is_share|lower }}' == 'true';
                var urls = {
                    'feed': '{% url "profiles-feed" profile_user.username %}',
                    'recommendations': '{% url "recommendations" %}'
                };

                FrameBuzzProfile.init(isMyProfile, isShare, urls);
            });
        </script>
    {% endcompress %}
    {% block extra_javascript %}{% endblock %}
{% endblock %}