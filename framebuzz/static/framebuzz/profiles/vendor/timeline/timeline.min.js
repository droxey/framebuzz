(function(a){function b(){this.leftLimit=0;this.rightLimit=0}b.prototype.reload=function(){a(".circle").remove();var b=this;if(a(window).width()>767){b.leftLimit=0;b.rightLimit=0;b.$container.find(".item").each(function(){var c=a(this);if(b.leftLimit>b.rightLimit){var d=b.rightLimit+c.outerHeight(true);if(d<b.leftLimit+20){d=b.leftLimit+20}c.removeClass("left").addClass("right");c.stop(false,true).css({top:d-c.outerHeight(true)+"px",left:"52%"});b.rightLimit=d}else{var d=b.leftLimit+c.outerHeight(true);if(d<b.rightLimit+20){d=b.rightLimit+20}c.removeClass("right").addClass("left");c.stop(false,true).css({top:d-c.outerHeight(true)+"px",left:"0"});b.leftLimit=d}var e=a('<span class="circle"></span>').appendTo(b.$innerContainer);e.css({top:d-c.find("footer").outerHeight(true)})});b.$innerContainer.height(Math.max(b.leftLimit,b.rightLimit)+20);b.$container.find(".comments-container").css("height","auto");b.$container.find(".comments-container").each(function(){var b=a(this).height();a(this).data("height",b).css({height:0})})}else{b.$container.find(".item").stop(true,true).css({top:"auto",left:"auto"});var c=0;b.$container.find(".item").each(function(){var b=a(this);c+=b.outerHeight(true)});b.$innerContainer.height(c)}};b.prototype.init=function(b){var c=this;c.reload();c.reload();c.initEvents();if(b.infiniteScroll){c.loading=false;c.iteration=0;c.$container.find(".loadMore").click(function(){if(c.loading){return false}c.loading=true;c.$container.find(".loadMore").toggleClass("loading");var d=b.data(c.iteration);a.ajax({url:b.url,data:d,success:function(a){if(a==""){c.$container.find(".loadMore").removeClass("loading").find("p").html(b.doneText);c.loading=true;return}c.$innerContainer.append(a);c.$container.find(".loadMore").toggleClass("loading");c.reload();c.reload();c.initEvents();c.loading=false;c.iteration=1},dataType:"html"})})}if(b.scrollForMore){a(window).scroll(function(){var b=c.$container.find(".loadMore").offset();if(b.top-a(window).height()<=a(window).scrollTop()&&!c.loading){c.$container.find(".loadMore").click()}})}};b.prototype.initEvents=function(){var b=this;b.$container.find(".comments-container").each(function(){if(!a(this).data("height")){var b=a(this).height();a(this).data("height",b).css({height:0})}});b.$container.find(".tags").find(".icon").unbind("click").toggle(function(){var b=a(this).parent().parent().find(".cover").height();a(this).parent().find(".tags-container").animate({height:b+"px"});return false},function(){a(this).parent().find(".tags-container").animate({height:0});return false});b.$container.find(".comments-toggle").unbind("click").click(function(){$parent=a(this).parent().parent();if(!$parent.hasClass("shown")){$parent.addClass("shown");$commentsContainer=$parent.find(".comments-container");var c=parseInt($parent.css("marginBottom"));$parent.css({marginBottom:c+$commentsContainer.data("height")+"px"});b.reload();$commentsContainer.animate({height:$commentsContainer.data("height")+"px"},750);$parent.animate({marginBottom:c+"px"},750,function(){})}else{$parent.removeClass("shown");$commentsContainer=$parent.find(".comments-container");$commentsContainer.animate({height:"0px"},750,function(){b.reload()})}return false})};a.fn.rTimeline=function(c){var d={theme:"light",infiniteScroll:true,scrollForMore:true,url:"",doneText:"No more posts",data:function(a){return""}};c=a.extend(d,c);this.each(function(){var d=a(this);var e;e=new b;a(document).ready(function(){e.$container=d;d.addClass(c.theme);e.$innerContainer=d.find(".container")});a(window).load(function(){e.init(c)});a(window).resize(function(){e.reload()})});return this}})(jQuery);